\section{Introduction}

Large language models (LLMs) are increasingly used as judges: a model (or rubricized prompt) assigns a scalar score $S = s(X, A)$ to an answer $A$ given a prompt $X$. This setup is attractive: it is fast, cheap, and often strongly correlated with human preferences. As a result, many teams now compare policies by averaging raw judge scores and declaring a winner.

\subsection{What practitioners really want}

In day-to-day evaluation work there are two goals: (i) rank candidate policies on a shared prompt set; and (ii) when stakes justify it, estimate levels for a KPI that matters (e.g., pass rate), with a confidence interval. Both questions are causal: \emph{what would happen if we shipped policy $\pi$?} Formally, the target is
\begin{equation}
V(\pi) = \E[Y(\pi)],
\end{equation}
where $Y \in [0, 1]$ is the outcome of interest under the policy we would deploy.

\subsection{Why the heuristic fails}

Naively averaging judge scores is a heuristic that breaks in predictable ways:

\begin{itemize}
\item \textbf{Wrong scale.} Judge scores are not on your KPI scale; deltas can be misleading.
\item \textbf{Hidden drift and slice bias.} The meaning of a score can change across time, prompt families, or length; averages hide this.
\item \textbf{No uncertainty.} Without CIs it is hard to tell real uplifts from noise, especially at small label budgets.
\item \textbf{Off-policy illusion.} Reusing one judged log to assess many candidates without correction answers the wrong counterfactual (it reflects the logger, not the candidate).
\end{itemize}

\subsection{How CJE works}

\textbf{Causal Judge Evaluation (\cje)} turns judge scores into reliable estimates with confidence intervals. The core workflow:

\begin{enumerate}
\item \textbf{Calibrate:} Learn a mapping from judge scores to oracle labels on a small random sample (\autocal).
\item \textbf{Evaluate:} For on-policy comparison (\textbf{Direct Mode}), generate responses from each policy and average calibrated scores. For counterfactual inference (\textbf{Off-Policy}), reuse logged data with importance weighting.
\item \textbf{Report:} Confidence intervals that account for all uncertainty (\oua).
\end{enumerate}

Most users only need \textbf{Direct Mode}: generate outputs, calibrate judge scores, report CIs. For off-policy evaluation, \cje{} stabilizes importance weights (\simcal) and optionally adds a critic (\dr) for robustness. See §3 for details.

\subsection{Quick Start: Direct Mode for Model Comparison}

\textbf{Just want to compare models on an eval set?} This is the fastest path to reliable estimates with confidence intervals.

\paragraph{What you need:}
\begin{itemize}
\item 500--2000 prompts representative of deployment
\item Responses from each policy you want to compare
\item Judge scores for all responses (any scale works)
\item 50--150 oracle labels (ground truth on a random sample)
\end{itemize}

\paragraph{Steps:}
\begin{enumerate}
\item Generate outputs from each policy on the same prompts (paired sampling reduces variance).
\item Score all outputs with your judge (fixed version, frozen config).
\item Label a random sample of 50--150 examples with ground truth $Y$.
\item Run \textbf{Direct Mode} (§2)---CJE learns the judge$\to$oracle calibration $f(S)$ automatically via \autocal.
\item Check three core diagnostics: coverage (§4.1), calibration (§4.2), judge stability (§4.3).
\item Report estimates with 95\% CIs (includes \oua{} to account for calibrator uncertainty).
\end{enumerate}

\paragraph{What to read:}
\begin{itemize}
\item \textbf{Essential:} §2 (Direct Mode), §4.1--4.4 (core diagnostics), §6.1 (DM workflow).
\item \textbf{Skip for now:} §3 (off-policy methods), §4.5--4.7 (weight diagnostics).
\end{itemize}

You can return to off-policy methods (§3) later if you want counterfactual inference (``What if we deployed policy X?'') without regenerating outputs.

\subsection{Notation at a glance}

\begin{table}[h]
\centering
\caption{Key notation and terminology}
\label{tab:notation}
\begin{tabular}{ll}
\toprule
\textbf{Symbol/Term} & \textbf{Meaning} \\
\midrule
\multicolumn{2}{l}{\textit{Core symbols (all modes):}} \\
$X$ & Prompt (input) \\
$A$ & Response (action/output) \\
$S$ & Judge score $S = s(X, A) \in \mathbb{R}$ \\
$Y$ & Oracle label (ground truth outcome) $\in [0, 1]$ \\
$R$ & Calibrated reward $R = f(S) \in [0, 1]$ \\
\textbf{\autocal} & \textbf{AutoCal-R}: Automatic Calibration for Rewards \\
 & Isotonic map $f: S \to [0,1]$ learned from oracle slice \\
\textbf{\oua} & \textbf{OUA}: Oracle-Uncertainty Aware inference \\
 & Accounts for calibrator noise in confidence intervals \\
\textbf{\dm} & Direct Modeling (on-policy, fresh draws only) \\
\midrule
\multicolumn{2}{l}{\textit{Off-policy symbols (§3 only):}} \\
$\pi_0$ & Logging policy (baseline, deployed) \\
$\pi'$ & Candidate policy (target for evaluation) \\
$W_i$ & Raw importance weight $W_i = \pi'(A_i \mid X_i) / \pi_0(A_i \mid X_i)$ \\
$\tilde{w}_i$ & Stabilized, mean-one weight after \simcal \\
$w^{\text{sn}}_i$ & Self-normalized (Hájek) weight $w^{\text{sn}}_i = W_i / \bar{W}$ \\
\textbf{\simcal} & \textbf{SIMCal}: Score-Indexed Monotone Calibration \\
 & Stabilizes weights via monotone projection + variance cap \\
\textbf{\ips} & Importance Sampling (off-policy, logged data) \\
\textbf{\dr} & Doubly Robust (off-policy + critic/outcome model) \\
\bottomrule
\end{tabular}
\end{table}

\subsection{When you need more: Off-policy evaluation}

Direct Mode requires generating fresh outputs for each policy. If you want to answer counterfactual questions without regenerating---``What if we deployed policy X instead of our current baseline?''---you need off-policy methods:

\begin{itemize}
\item \textbf{Calibrated \ips{}} reuses a single logged dataset to evaluate multiple candidate policies by reweighting with importance ratios. Requires per-sequence log probabilities.

\item \textbf{Calibrated \dr{}} combines importance weighting with an outcome model for robustness and tighter confidence intervals. Requires both logged data and a small set of fresh draws.
\end{itemize}

Off-policy methods enable fast iteration (no regeneration), but introduce complexity (importance weights, overlap diagnostics). See §3 for full details, assumptions, and diagnostics. Most users should start with Direct Mode and adopt off-policy methods only when needed.

\subsection{Core diagnostics}

All CJE modes share three essential diagnostics that catch the most common failure modes:

\begin{enumerate}[label=(\alph*)]
\item \textbf{Score coverage:} Does the oracle slice span the evaluation $S$-range? (fix: add labels in uncovered bins)

\item \textbf{Calibration reliability:} Is $f(S)$ accurate across the $S$ spectrum? (fix: two-stage \autocal{} or add labels in problematic regions)

\item \textbf{Judge stability:} Is the judge's scoring consistent over time? (fix: freeze judge version, refresh oracle if drift detected)
\end{enumerate}

These three checks apply whether you're using Direct Mode or off-policy methods. For off-policy evaluation (§3), three additional diagnostics are required:

\begin{enumerate}[label=(\alph*),resume]
\item \textbf{Effective sample size (ESS):} Do we have enough effective samples after reweighting? (fix: cohort restriction or switch to DR)

\item \textbf{Tail heaviness:} Are importance weights catastrophically heavy-tailed? (fix: SIMCal tuning or overlap-aware cohorting)

\item \textbf{DR orthogonality:} Is the outcome model orthogonal to the weights? (fix: improve critic or revisit weight calibration)
\end{enumerate}

See §4 for detailed thresholds, interpretation, and fixes for each diagnostic.

\subsection{What CJE provides}

\cje{} gives practitioners a complete workflow for reliable LLM evaluation:

\begin{itemize}
\item \textbf{Three analysis modes:} Direct Mode for on-policy comparison (simplest), Calibrated IPS for off-policy reuse, Calibrated DR for maximum accuracy when you have both logged data and fresh draws.

\item \textbf{Automatic calibration:} \autocal{} maps judge scores to oracle labels on a small random sample, putting estimates on the right scale.

\item \textbf{Honest confidence intervals:} \oua{} accounts for calibrator uncertainty, not just sampling noise.

\item \textbf{Six diagnostics:} Three core checks (coverage, calibration, judge stability) plus three off-policy checks (ESS, tail heaviness, orthogonality). Each includes thresholds, interpretation, and concrete fixes.

\item \textbf{Off-policy robustness:} \simcal{} stabilizes importance weights via monotone projection, and DR adds an outcome model for double robustness.
\end{itemize}

\subsection{Scope and positioning}

This playbook focuses on practical implementation: assumptions in plain English, minimal recipes, diagnostics with actionable fixes, and reporting templates. Advanced material (theoretical guarantees, projection properties, semiparametric efficiency) lives in the appendix.

\cje{} builds on the treatment effect estimation literature, particularly work on efficient estimation with surrogates and limited outcome data \cite{kallus2024role}. Like that work, we avoid restrictive surrogacy conditions and instead study efficiency gains when surrogates supplement---rather than replace---primary outcomes under standard missing-at-random assumptions.

\subsection{Reader's guide}

\paragraph{For quick model comparison:} Start with the Quick Start (§1.5), then read §2 (Direct Mode), §4.1--4.4 (core diagnostics), and §6.1 (DM workflow). Skip §3 and §4.5--4.7 unless you later need counterfactual inference.

\paragraph{For comprehensive coverage:} We begin with \dm---the default when you can generate on shared prompts---then show how to reuse judged logs with Calibrated \ips{} and Calibrated \dr, followed by diagnostics, assumptions for causal interpretation, a practical playbook, compact case studies, and implementation notes.
